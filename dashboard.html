  
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Law Enforcement - Dashboard</title>
  <style>
    /* Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

    html, body {
      height: 100%;
      width: 100%;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
    }

    /* Flex layout ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
    body {
      display: flex;
      flex-direction: column;
    }

    header {
      background-color: rgba(0,0,0,0.6);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    header h1 {
      font-size: 1.5rem;
    }

    main {
      flex: 1;
      display: flex;
      padding: 20px;
      gap: 20px;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .sidebar button {
      padding: 12px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
      color: #fff;
    }

    #startDuty { background-color: #ef4444; }
    #endDuty { background-color: #10b981; }

    .sidebar button:hover:not(:disabled) {
      opacity: 0.9;
      transform: scale(1.05);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Content area */
    .content {
      flex: 1;
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 20px;
      padding: 20px;
      overflow-y: auto;
    }

    #logs {
      list-style: none;
      max-height: 100%;
      overflow-y: auto;
      padding-left: 0;
    }

    #logs li {
      background: #f3f4f6;
      margin-bottom: 8px;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 0.95rem;
      color: #1f2937;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    #logs::-webkit-scrollbar {
      width: 8px;
    }

    #logs::-webkit-scrollbar-track {
      background: #e5e7eb;
      border-radius: 10px;
    }

    #logs::-webkit-scrollbar-thumb {
      background: #9ca3af;
      border-radius: 10px;
    }

    footer {
      padding: 10px 30px;
      text-align: center;
      background-color: rgba(0,0,0,0.5);
    }

    .officer-info {
      margin-bottom: 20px;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
  <audio id="clickSound" src="click.mp3" preload="auto"></audio>

  <header>
    <h1>üöì Dashboard ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h1>
    <div id="time">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: --:--</div>
  </header>

  <main>
    <div class="sidebar">
      <div class="officer-info" id="info">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</div>
      <button id="startDuty">üö® ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
      <button id="endDuty" disabled>‚úÖ ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£</button>
    </div>

    <div class="content">
      <h2>üìú Duty Logs (Realtime)</h2>
      <ul id="logs"></ul>
    </div>
  </main>

  <footer>
    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ¬© 2025
  </footer>
</body>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // üîß config ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  const firebaseConfig = {
    apiKey: "AIzaSyATTiyInUWaiPuGVj7DXzd8SLhJOGmbiq4",
    authDomain: "data-service-467404.firebaseapp.com",
    databaseURL: "https://data-service-467404-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "data-service-467404",
    storageBucket: "data-service-467404.appspot.com",
    messagingSenderId: "860747048785",
    appId: "1:860747048785:web:dd47ad5daa9595027dd570",
    measurementId: "G-1X08RZGGEF"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà
  const name = localStorage.getItem("name");
  const rank = localStorage.getItem("rank");
  const officerId = localStorage.getItem("officerId");
  const loginTime = localStorage.getItem("loginTime");
  const clickSound = document.getElementById("clickSound");

  if(name && officerId) {
    document.getElementById("info").textContent = `${rank} ${name} | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß: ${officerId}`;
    document.getElementById("time").textContent = `‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${loginTime}`;
  }

  const logsEl = document.getElementById("logs");
  const startBtn = document.getElementById("startDuty");
  const endBtn = document.getElementById("endDuty");

  let currentSessionKey = null; 
  let isOnDuty = false; // ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà


// ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
window.addEventListener("load", () => {
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ session ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£‡πÉ‡∏ô LocalStorage
  const savedSessionKey = localStorage.getItem("currentSessionKey");
  const savedIsOnDuty = localStorage.getItem("isOnDuty") === "true";

  if (savedSessionKey && savedIsOnDuty) {
    currentSessionKey = savedSessionKey;
    isOnDuty = true;
    startBtn.disabled = true;
    endBtn.disabled = false;
  } else {
    startBtn.disabled = false;
    endBtn.disabled = true;
  }

  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ session ‡πÉ‡∏ô Firebase ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£ ‡πÉ‡∏´‡πâ‡∏ã‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡πâ‡∏ß‡∏¢
  db.ref("roster-logs").orderByChild("officerId").equalTo(officerId)
    .limitToLast(1)
    .once("value", snapshot => {
      snapshot.forEach(child => {
        const log = child.val();
        if (log && !log.endTime) {
          currentSessionKey = child.key;
          isOnDuty = true;
          startBtn.disabled = true;
          endBtn.disabled = false;

          // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï LocalStorage
          localStorage.setItem("currentSessionKey", currentSessionKey);
          localStorage.setItem("isOnDuty", "true");
        }
      });
    });
});


  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
function startDuty() {
  clickSound.play(); // üîä ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  if (isOnDuty) {
    alert("‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }

  const startTime = new Date().toISOString();
  const logData = {
    officerId,
    name,
    rank,
    action: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà üö®",
    startTime: startTime
  };
  const ref = db.ref("roster-logs").push(logData);
  currentSessionKey = ref.key;
  isOnDuty = true;

  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï LocalStorage
  localStorage.setItem("currentSessionKey", currentSessionKey);
  localStorage.setItem("isOnDuty", "true");

  startBtn.disabled = true;
  endBtn.disabled = false;
  }

  // ‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£
function endDuty() {
  clickSound.play(); // üîä ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  if (!isOnDuty || !currentSessionKey) {
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô");
    return;
  }

  const endTime = new Date().toISOString();
  db.ref("roster-logs/" + currentSessionKey).once("value", snapshot => {
    const data = snapshot.val();
    if (data && data.startTime) {
      const durationMs = new Date(endTime) - new Date(data.startTime);

      const hours = Math.floor(durationMs / 1000 / 60 / 60);
      const minutes = Math.floor((durationMs / 1000 / 60) % 60);
      const seconds = Math.floor((durationMs / 1000) % 60);
      const durationStr = `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;

      db.ref("roster-logs/" + currentSessionKey).update({
        action: "‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£ ‚úÖ",
        endTime: endTime,
        duration: durationStr
      });

      currentSessionKey = null;
      isOnDuty = false;

      // ‡∏•‡∏ö LocalStorage
      localStorage.removeItem("currentSessionKey");
      localStorage.removeItem("isOnDuty");

      startBtn.disabled = false;
      endBtn.disabled = true;
      }
    });
  }

  // ‡πÅ‡∏™‡∏î‡∏á logs Realtime
  db.ref("roster-logs").on("child_added", snapshot => renderLog(snapshot));
  db.ref("roster-logs").on("child_changed", snapshot => renderLog(snapshot, true));

  function renderLog(snapshot, isUpdate = false) {
    const log = snapshot.val();
    const liId = "log-" + snapshot.key;
    let li = document.getElementById(liId);

    if (!li) {
      li = document.createElement("li");
      li.id = liId;
      logsEl.appendChild(li);
    }

    let text = `${log.rank} ${log.name} (${log.officerId}) ‚Üí ${log.action}`;
    if (log.startTime) {
      text += ` | ‡πÄ‡∏£‡∏¥‡πà‡∏°: ${new Date(log.startTime).toLocaleString("th-TH")}`;
    }
    if (log.endTime) {
      text += ` | ‡πÄ‡∏•‡∏¥‡∏Å: ${new Date(log.endTime).toLocaleString("th-TH")}`;
    }
    if (log.duration) {
      text += ` | ‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤: ${log.duration}`;
    }

    li.textContent = text;
  }

  // Event ‡∏õ‡∏∏‡πà‡∏°
  startBtn.addEventListener("click", startDuty);
  endBtn.addEventListener("click", endDuty);
</script>
</body>
</html>
